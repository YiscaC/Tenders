<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>

```
<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
    <div class="container d-flex justify-content-start align-items-center">
        <a class="navbar-brand">
            <img src="image/il.png" alt="Logo" width="20" class="d-inline-block align-text-top">
        </a>
        <a class="navbar-brand" href="home.html" data-bs-toggle="tooltip" data-bs-placement="bottom"
            title="דף הבית">
            <i class="bi bi-house my-button"></i>
        </a>
        <span id="user-nav-item" style="display: none;"></span>
    </div>
</nav>


<div class="container-fluid mt-4">
    <div class="d-flex justify-content-center align-items-center">
        <div class="col-6">
            <div class="card login-card mx-auto mt-3">
                <div class="card-header bg-light">
                    <h2 class="login-title">🔐 כניסה לאתר</h2>
                </div>
                <div class="card-body">
                    <form id="loginForm">
                        <label class="form-label" for="login-email">אימייל</label>
                            <div class="input-group input-group-rtl">
                                <span class="input-group-text">
                                    <i class="bi bi-envelope-fill"></i>
                                </span>
                                <input class="form-control" type="email" id="login-email" name="email" required
                                    data-bs-toggle="tooltip" title="הכנס את כתובת האימייל שלך">
                            </div>

                            <label class="form-label mt-2" for="login-password">סיסמה</label>
                            <div class="input-group input-group-rtl">
                                <span class="input-group-text">
                                    <i class="bi bi-key-fill"></i>
                                </span>
                                <input class="form-control" type="password" id="login-password" name="password" required
                                    data-bs-toggle="tooltip" title="הכנס את הסיסמה שלך">
                            </div>

                        <div class="text-center mt-3">
                            <input class="form-control form-button" type="submit" value="כניסה">                                                      
                            <input class="form-control form-button mb-2" type="button" value="משתמש חדש"
                            data-bs-toggle="modal" data-bs-target="#registerModal">
                        </div>
                        <div id="g_id_onload"
 data-client_id="119189325747-a84euov4bs6253ns12uuc1ii5fa8svcn.apps.googleusercontent.com"
 data-callback="handleCredentialResponse"
 data-auto_prompt="false">
</div>

<div class="g_id_signin"
     data-type="standard"
     data-size="large"
     data-theme="outline"
     data-text="sign_in_with"
     data-shape="rectangular"
     data-logo_alignment="left">
</div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="alert-container" class="container mt-3"></div>

<!-- Modal -->
<div class="modal-content">
    <div class="container-fluid mt-4">
        <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <!-- כפתור סגירה מעל הכותרת -->
                    <button type="button" class="btn-close modal-close-top" data-bs-dismiss="modal" aria-label="Close"></button>
                    <div class="modal-header">
                    <h5 class="modal-title w-100 text-center register-title" id="registerModalLabel" dir="rtl">📝 הרשמה לאתר</h5>
                    </div>                       
                    <div class="modal-body">
                        <form id="registerForm">
                            <label class="form-label" for="register-username">שם פרטי</label>
                            <div class="input-group input-group-rtl">
                                <span class="input-group-text">
                                    <i class="bi bi-person-fill"></i>
                                </span>
                                <input class="form-control" type="text" id="register-username" name="name" required
                                    data-bs-toggle="tooltip" title="הכנס את שם המשתמש שלך">
                            </div>
                            <label class="form-label mt-2" for="register-email">אימייל</label>
                            <div class="input-group input-group-rtl">
                                <span class="input-group-text">
                                    <i class="bi bi-envelope-fill"></i>
                                </span>
                                <input class="form-control" type="email" id="register-email" name="email" required
                                    data-bs-toggle="tooltip" title="הכנס את כתובת האימייל שלך">
                            </div>
                            <label class="form-label mt-2" for="register-password">סיסמה</label>
                            <div class="input-group input-group-rtl">
                                <span class="input-group-text">
                                    <i class="bi bi-key-fill"></i>
                                </span>
                                <input class="form-control" type="password" id="register-password" name="password"
                                    required data-bs-toggle="tooltip" title="הכנס סיסמה חזקה">
                            </div>
                            <div class="text-center mt-2">
                                <input class="form-control form-button mt-3" type="submit" value="הירשם">
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
<script src="user.js"></script>
<script>
    window.handleCredentialResponse = async function (response) {
      const token = response.credential;
      console.log("Google ID Token:", token);
  
      try {
        const res = await fetch('http://localhost:3001/api/google-login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ token })
        });
  
        const data = await res.json();
  
        if (!res.ok) {
          Swal.fire({
            icon: 'error',
            title: 'התחברות עם גוגל נכשלה',
            text: data.message || 'נסה שוב מאוחר יותר'
          });
          return;
        }
  
        localStorage.setItem('user', JSON.stringify({ name: data.name, email: data.email }));
        localStorage.setItem('userEmail', data.email);
  
        Swal.fire({
          title: `שלום ${data.name}`,
          text: 'התחברת בהצלחה דרך Google!',
          confirmButtonText: 'אישור'
        }).then(() => {
          window.location.href = "home.html";
        });
      } catch (err) {
        console.error("Login error:", err);
        Swal.fire({
          icon: 'error',
          title: 'שגיאה',
          text: 'שגיאה בהתחברות עם גוגל.'
        });
      }
    };
  </script>
  
<script>
    // Initialize tooltips
    $(function () {
        $('[data-bs-toggle="tooltip"]').tooltip();
    });
</script>
```

</body>

</html>
